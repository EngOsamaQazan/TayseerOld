TABLE_NAME	VIEW_DEFINITION
os_follow_up_report	select `c`.`id` AS `id`,`c`.`type` AS `type`,`c`.`seller_id` AS `seller_id`,`c`.`Date_of_sale` AS `Date_of_sale`,`c`.`total_value` AS `total_value`,`c`.`first_installment_value` AS `first_installment_value`,`c`.`first_installment_date` AS `first_installment_date`,`c`.`monthly_installment_value` AS `monthly_installment_value`,`c`.`notes` AS `notes`,`c`.`status` AS `status`,`c`.`updated_at` AS `updated_at`,`c`.`is_deleted` AS `is_deleted`,`c`.`selected_image` AS `selected_image`,`c`.`company_id` AS `company_id`,`c`.`commitment_discount` AS `commitment_discount`,`c`.`loss_commitment` AS `loss_commitment`,`c`.`created_by` AS `created_by`,`c`.`updated_by` AS `updated_by`,`c`.`created_at` AS `created_at`,`c`.`follow_up_lock_by` AS `follow_up_lock_by`,`c`.`follow_up_lock_at` AS `follow_up_lock_at`,`c`.`followed_by` AS `followed_by`,`c`.`is_can_not_contact` AS `is_can_not_contact`,`f`.`date_time` AS `last_follow_up`,`f`.`promise_to_pay_at` AS `promise_to_pay_at`,`f`.`reminder` AS `reminder`,ifnull(`payments`.`total_paid`,0) AS `total_paid`,coalesce(`ls`.`monthly_installment`,`c`.`monthly_installment_value`) AS `effective_installment`,greatest(0,period_diff(date_format(curdate(),'%Y%m'),date_format(coalesce(`ls`.`first_installment_date`,`c`.`first_installment_date`),'%Y%m')) + case when dayofmonth(curdate()) >= dayofmonth(coalesce(`ls`.`first_installment_date`,`c`.`first_installment_date`)) then 1 else 0 end) AS `due_installments`,case when `jud`.`jud_id` is not null and `ls`.`id` is null then greatest(0,`c`.`total_value` + ifnull(`exp_sum`.`total_expenses`,0) + ifnull(`jud`.`total_lawyer`,0) - ifnull(`payments`.`total_paid`,0)) else greatest(0,greatest(0,period_diff(date_format(curdate(),'%Y%m'),date_format(coalesce(`ls`.`first_installment_date`,`c`.`first_installment_date`),'%Y%m')) + case when dayofmonth(curdate()) >= dayofmonth(coalesce(`ls`.`first_installment_date`,`c`.`first_installment_date`)) then 1 else 0 end) * coalesce(`ls`.`monthly_installment`,`c`.`monthly_installment_value`) - ifnull(`payments`.`total_paid`,0)) end AS `due_amount`,case when `f`.`id` is null then 1 else 0 end AS `never_followed` from (((((`namaa_jadal`.`os_contracts` `c` left join `namaa_jadal`.`os_follow_up` `f` on(`f`.`contract_id` = `c`.`id` and `f`.`id` = (select max(`namaa_jadal`.`os_follow_up`.`id`) from `namaa_jadal`.`os_follow_up` where `namaa_jadal`.`os_follow_up`.`contract_id` = `c`.`id`))) left join `namaa_jadal`.`os_loan_scheduling` `ls` on(`ls`.`contract_id` = `c`.`id` and `ls`.`is_deleted` = 0 and `ls`.`id` = (select max(`namaa_jadal`.`os_loan_scheduling`.`id`) from `namaa_jadal`.`os_loan_scheduling` where `namaa_jadal`.`os_loan_scheduling`.`contract_id` = `c`.`id` and `namaa_jadal`.`os_loan_scheduling`.`is_deleted` = 0))) left join (select `namaa_jadal`.`os_income`.`contract_id` AS `contract_id`,sum(`namaa_jadal`.`os_income`.`amount`) AS `total_paid` from `namaa_jadal`.`os_income` group by `namaa_jadal`.`os_income`.`contract_id`) `payments` on(`c`.`id` = `payments`.`contract_id`)) left join (select `namaa_jadal`.`os_judiciary`.`contract_id` AS `contract_id`,max(`namaa_jadal`.`os_judiciary`.`id`) AS `jud_id`,sum(`namaa_jadal`.`os_judiciary`.`lawyer_cost`) AS `total_lawyer` from `namaa_jadal`.`os_judiciary` where `namaa_jadal`.`os_judiciary`.`is_deleted` = 0 group by `namaa_jadal`.`os_judiciary`.`contract_id`) `jud` on(`jud`.`contract_id` = `c`.`id`)) left join (select `namaa_jadal`.`os_expenses`.`contract_id` AS `contract_id`,sum(`namaa_jadal`.`os_expenses`.`amount`) AS `total_expenses` from `namaa_jadal`.`os_expenses` group by `namaa_jadal`.`os_expenses`.`contract_id`) `exp_sum` on(`exp_sum`.`contract_id` = `c`.`id`)) where `c`.`status` not in ('finished','canceled','refused') and (`c`.`is_can_not_contact` = 0 and (`jud`.`jud_id` is not null and `ls`.`id` is null and `c`.`total_value` + ifnull(`exp_sum`.`total_expenses`,0) + ifnull(`jud`.`total_lawyer`,0) - ifnull(`payments`.`total_paid`,0) > 5 or (`jud`.`jud_id` is null or `ls`.`id` is not null) and greatest(0,period_diff(date_format(curdate(),'%Y%m'),date_format(coalesce(`ls`.`first_installment_date`,`c`.`first_installment_date`),'%Y%m')) + case when dayofmonth(curdate()) >= dayofmonth(coalesce(`ls`.`first_installment_date`,`c`.`first_installment_date`)) then 1 else 0 end) * coalesce(`ls`.`monthly_installment`,`c`.`monthly_installment_value`) - ifnull(`payments`.`total_paid`,0) > 5) or `c`.`is_can_not_contact` = 1) order by case when `f`.`id` is null then 0 else 1 end,`f`.`date_time`
vw_contracts_screen	select `c`.`id` AS `contract_id`,trim(concat_ws(' ',`us`.`name`,`us`.`middle_name`,`us`.`last_name`)) AS `seller_name`,trim(concat_ws(' ',`uf`.`name`,`uf`.`middle_name`,`uf`.`last_name`)) AS `followed_by_name`,group_concat(distinct `cu`.`name` order by `cu`.`name` ASC separator ' -- ') AS `customers_names`,greatest((period_diff(date_format(curdate(),'%Y%m'),date_format(`c`.`first_installment_date`,'%Y%m')) + case when dayofmonth(curdate()) >= dayofmonth(`c`.`first_installment_date`) then 1 else 0 end) * ifnull(`c`.`monthly_installment_value`,0) - ifnull(`p`.`total_paid`,0),0) AS `deserved_amount`,cast(`c`.`Date_of_sale` as date) AS `Date_of_sale`,`c`.`total_value` AS `total_value`,`c`.`first_installment_value` AS `first_installment_value`,`c`.`status` AS `status`,greatest(ifnull(`c`.`total_value`,0) - ifnull(`p`.`total_paid`,0),0) AS `remaining_amount`,`c`.`followed_by` AS `followed_by_id`,`c`.`seller_id` AS `seller_id` from (((((`namaa_jadal`.`os_contracts` `c` left join `namaa_jadal`.`os_contracts_customers` `occ` on(`occ`.`contract_id` = `c`.`id`)) left join `namaa_jadal`.`os_customers` `cu` on(`cu`.`id` = `occ`.`customer_id`)) left join (select `namaa_jadal`.`os_income`.`contract_id` AS `contract_id`,sum(`namaa_jadal`.`os_income`.`amount`) AS `total_paid` from `namaa_jadal`.`os_income` group by `namaa_jadal`.`os_income`.`contract_id`) `p` on(`p`.`contract_id` = `c`.`id`)) left join `namaa_jadal`.`os_user` `us` on(`us`.`id` = `c`.`seller_id`)) left join `namaa_jadal`.`os_user` `uf` on(`uf`.`id` = `c`.`followed_by`)) where `c`.`is_deleted` = 0 group by `c`.`id`,trim(concat_ws(' ',`us`.`name`,`us`.`middle_name`,`us`.`last_name`)),trim(concat_ws(' ',`uf`.`name`,`uf`.`middle_name`,`uf`.`last_name`)),`c`.`Date_of_sale`,`c`.`total_value`,`c`.`first_installment_value`,`c`.`status`,`c`.`first_installment_date`,`c`.`monthly_installment_value`,`p`.`total_paid`,`c`.`followed_by`,`c`.`seller_id`
os_inventory_dashboard_company1	select `i`.`id` AS `item_id`,`i`.`item_name` AS `item_name`,`i`.`item_barcode` AS `item_barcode`,coalesce(`q`.`available_qty`,0) AS `available_qty`,coalesce(`sn`.`available_serials`,0) AS `available_serials`,coalesce(`sn`.`sold_serials`,0) AS `sold_serials`,coalesce(`sn`.`dummy_serials`,0) AS `legacy_dummy_serials`,coalesce(`q`.`available_qty`,0) - coalesce(`sn`.`available_serials`,0) AS `qty_vs_serials_diff` from ((`namaa_jadal`.`os_inventory_items` `i` left join (select `namaa_jadal`.`os_inventory_item_quantities`.`item_id` AS `item_id`,sum(`namaa_jadal`.`os_inventory_item_quantities`.`quantity`) AS `available_qty` from `namaa_jadal`.`os_inventory_item_quantities` where `namaa_jadal`.`os_inventory_item_quantities`.`company_id` = 1 and `namaa_jadal`.`os_inventory_item_quantities`.`is_deleted` = 0 group by `namaa_jadal`.`os_inventory_item_quantities`.`item_id`) `q` on(`q`.`item_id` = `i`.`id`)) left join (select `namaa_jadal`.`os_inventory_serial_numbers`.`item_id` AS `item_id`,sum(case when `namaa_jadal`.`os_inventory_serial_numbers`.`status` = 'available' and `namaa_jadal`.`os_inventory_serial_numbers`.`is_deleted` = 0 then 1 else 0 end) AS `available_serials`,sum(case when `namaa_jadal`.`os_inventory_serial_numbers`.`status` = 'sold' and `namaa_jadal`.`os_inventory_serial_numbers`.`is_deleted` = 0 then 1 else 0 end) AS `sold_serials`,sum(case when `namaa_jadal`.`os_inventory_serial_numbers`.`serial_number` like 'DUMMY-%' and `namaa_jadal`.`os_inventory_serial_numbers`.`is_deleted` = 0 then 1 else 0 end) AS `dummy_serials` from `namaa_jadal`.`os_inventory_serial_numbers` where `namaa_jadal`.`os_inventory_serial_numbers`.`company_id` = 1 group by `namaa_jadal`.`os_inventory_serial_numbers`.`item_id`) `sn` on(`sn`.`item_id` = `i`.`id`)) where `i`.`is_deleted` = 0 order by coalesce(`q`.`available_qty`,0) desc,coalesce(`sn`.`sold_serials`,0) desc,`i`.`item_name`
vw_persistence_report	select `j`.`id` AS `judiciary_id`,`j`.`judiciary_number` AS `judiciary_number`,`j`.`year` AS `case_year`,`co`.`name` AS `court_name`,`c`.`id` AS `contract_id`,substring_index(group_concat(`cu`.`name` order by `jca`.`action_date` DESC,`jca`.`id` DESC separator '||'),'||',1) AS `customer_name`,substring_index(group_concat(`ja`.`name` order by `jca`.`action_date` DESC,`jca`.`id` DESC separator '||'),'||',1) AS `last_action_name`,cast(max(`jca`.`action_date`) as date) AS `last_action_date`,case when timestampdiff(MONTH,max(`jca`.`action_date`),curdate()) > 11 or timestampdiff(MONTH,max(`jca`.`action_date`),curdate()) = 11 and to_days(curdate()) - to_days(cast(max(`jca`.`action_date`) as date) + interval timestampdiff(MONTH,max(`jca`.`action_date`),curdate()) month) > 25 then 'red_renew' when timestampdiff(MONTH,max(`jca`.`action_date`),curdate()) = 11 and to_days(curdate()) - to_days(cast(max(`jca`.`action_date`) as date) + interval timestampdiff(MONTH,max(`jca`.`action_date`),curdate()) month) between 0 and 25 then 'red_due' when timestampdiff(MONTH,max(`jca`.`action_date`),curdate()) = 10 then 'orange_due' when timestampdiff(MONTH,max(`jca`.`action_date`),curdate()) >= 9 then 'green_due' else concat('remaining_',greatest(0,timestampdiff(MONTH,curdate(),max(`jca`.`action_date`) + interval 9 month)),'_',greatest(0,to_days(max(`jca`.`action_date`) + interval 9 month) - to_days(curdate() + interval timestampdiff(MONTH,curdate(),max(`jca`.`action_date`) + interval 9 month) month))) end AS `persistence_status`,cast(`lfp`.`latest_follow_up_date` as date) AS `last_followup_date`,substring_index(group_concat(cast(`cu`.`last_job_query_date` as date) order by `jca`.`action_date` DESC,`jca`.`id` DESC separator '||'),'||',1) AS `last_job_check_date`,`lw`.`name` AS `lawyer_name`,substring_index(group_concat(ifnull(`jb`.`name`,'') order by `jca`.`action_date` DESC,`jca`.`id` DESC separator '||'),'||',1) AS `job_title`,substring_index(group_concat(ifnull(`jbt`.`name`,'') order by `jca`.`action_date` DESC,`jca`.`id` DESC separator '||'),'||',1) AS `job_type` from (((((((((`namaa_jadal`.`os_contracts` `c` join `namaa_jadal`.`os_judiciary` `j` on(`j`.`contract_id` = `c`.`id`)) join `namaa_jadal`.`os_court` `co` on(`co`.`id` = `j`.`court_id`)) join `namaa_jadal`.`os_lawyers` `lw` on(`lw`.`id` = `j`.`lawyer_id`)) join `namaa_jadal`.`os_judiciary_customers_actions` `jca` on(`jca`.`judiciary_id` = `j`.`id` and `jca`.`is_deleted` = 0)) join `namaa_jadal`.`os_judiciary_actions` `ja` on(`ja`.`id` = `jca`.`judiciary_actions_id`)) join `namaa_jadal`.`os_customers` `cu` on(`cu`.`id` = `jca`.`customers_id`)) left join `namaa_jadal`.`os_jobs` `jb` on(`jb`.`id` = `cu`.`job_title`)) left join `namaa_jadal`.`os_jobs_type` `jbt` on(`jbt`.`id` = `jb`.`job_type`)) left join (select `namaa_jadal`.`os_follow_up`.`contract_id` AS `contract_id`,max(`namaa_jadal`.`os_follow_up`.`date_time`) AS `latest_follow_up_date` from `namaa_jadal`.`os_follow_up` group by `namaa_jadal`.`os_follow_up`.`contract_id`) `lfp` on(`lfp`.`contract_id` = `c`.`id`)) where `c`.`status` in ('pending','active','reconciliation','judiciary','legal_department','settlement') and `j`.`is_deleted` = 0 group by `j`.`id`,`j`.`judiciary_number`,`j`.`year`,`co`.`name`,`c`.`id`,`lw`.`name` order by `co`.`name`,`c`.`id`,`j`.`judiciary_number`
