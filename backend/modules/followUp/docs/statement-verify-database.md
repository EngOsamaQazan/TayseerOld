# كشف الحساب والتحقق من الباركود — قاعدة البيانات

## لا يوجد أي تعديلات DDL مطلوبة

ميزة **كشف الحساب** (printer) و**التحقق من الباركود** (verify-statement) **لا تحتاج إلى أي تغيير في قاعدة البيانات**.  
لم يتم إنشاء جداول جديدة ولا أعمدة إضافية ولا migrations.

التحقق يعتمد فقط على قراءة من الجداول الحالية:

| الجدول         | العمود (التاريخ) | الاستخدام                    |
|----------------|------------------|------------------------------|
| `os_contracts` | `Date_of_sale`   | تاريخ البيع                  |
| `os_judiciary` | `created_at`     | تاريخ إضافة سجل قضائي        |
| `os_expenses`  | `created_at`     | تاريخ إضافة مصروف            |
| `os_income`    | `date`           | تاريخ الدفعة (القسط)         |

---

## سكريبت التحقق (للمرجع فقط — لا يعدّل البنية)

الاستعلام التالي هو **للمرجع فقط** ويُستخدمه التطبيق لمعرفة "آخر تاريخ حركة" على العقد.  
**لا تنفّذه كتعديل على البنية** — الجداول والأعمدة يجب أن تكون موجودة مسبقاً في مشروعك.

```sql
-- ============================================================
-- مرجع: استعلام آخر تاريخ حركة على العقد (يستخدمه verify-statement)
-- لا يُنشئ ولا يعدّل أي جدول — للتشغيل الاختياري للتحقق يدوياً فقط
-- ============================================================

-- مثال: آخر تاريخ حركة للعقد 1811
SELECT MAX(dt) AS last_movement_date
FROM (
    SELECT DATE(Date_of_sale) AS dt FROM os_contracts WHERE id = 1811
    UNION ALL
    SELECT DATE(created_at)   FROM os_judiciary WHERE contract_id = 1811
    UNION ALL
    SELECT DATE(created_at)   FROM os_expenses WHERE contract_id = 1811
    UNION ALL
    SELECT DATE(date)         FROM os_income WHERE contract_id = 1811
) u;
```

---

## الخلاصة

- **قاعدة البيانات السحابية:** لا تحتاج إلى أي سكريبت تعديل.  
- إذا كانت الجداول `os_contracts`, `os_judiciary`, `os_expenses`, `os_income` وأعمدة التواريخ موجودة كما في مشروعك الحالي، فالميزة تعمل كما هي.
