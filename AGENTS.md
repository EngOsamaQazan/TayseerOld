# AGENTS.md

## Cursor Cloud specific instructions

### Overview

Tayseer ERP (نظام تيسير) is a Yii 2 Advanced Template application with four tiers: **backend** (main admin panel), **frontend** (not actively used), **console** (CLI/migrations), and **api** (REST). All tiers share `common/` models and config. The primary language is Arabic (ar-JO).

### Services

| Service | How to start | Notes |
|---------|-------------|-------|
| MariaDB | `sudo mysqld_safe &` | Databases: `namaa_erp`, `namaa_jadal`, `yii2advanced_test` |
| Apache | `sudo apachectl start` | Serves backend at `http://localhost/` (DocumentRoot: `backend/web/`) |

### Dev login

- Username: `admin` / Password: `admin123` at `http://localhost/user/login`

### Key commands

- **Install deps:** `composer install` (from repo root)
- **Init environment:** `php init --env=Development --overwrite=All`
- **Run migrations:** `php yii migrate --interactive=0`
- **Run tests:** `cd backend && ../vendor/bin/codecept run` (test DB: `yii2advanced_test`)
- **PHP lint:** `php -l <file>` (no phpcs/phpstan configured)

### Gotchas

- **Migrations fail from scratch.** The migration history assumes an existing production database backup. Several migrations use duplicate FK names or drop-then-alter patterns that break on a fresh DB. Failing migrations must be manually skipped (mark as applied in `os_migration` table) or fixed at the DB level.
- **`os_system_settings` table** is not created by any migration but is required by the Customers module. Create it manually if missing.
- **Uploads directory** (`backend/web/uploads/`) must exist and be writable by the web server; otherwise, investor/company creation fails with a permissions error.
- **RBAC permissions** must be seeded manually for a fresh database. Without auth_item/auth_assignment entries, logged-in users get 403 on all pages. The `common/helper/Permissions.php` file defines all permission constants.
- **Test fixtures** reference `password_reset_token` column which doesn't exist in the custom `os_user` table. Codeception functional tests will error on fixture loading unless the schema or fixtures are updated.
- **No `composer.lock`** is committed. `composer install` resolves to latest compatible versions each time.
- **Config files** (`*-local.php`) are generated by `php init` and are gitignored. DB credentials must be set in `common/config/main-local.php` after init.
